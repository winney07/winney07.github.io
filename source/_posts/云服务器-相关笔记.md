---
title: 云服务器-相关笔记
date: 2023-01-05 17:54:14
tags:
- 云服务器
---

[文档中心](https://jcloud.sjtu.edu.cn/document/index.html)

#### [云主机](https://jcloud.sjtu.edu.cn/document/detail.html?mod=cvm&id=622)——文档

[快速创建 Linux云主机](https://jcloud.sjtu.edu.cn/document/detail.html?mod=qstart&id=1029)

[Linux命令大全](https://linux265.com/course/linux-commands.html) 

#### [CentOS-download](https://www.centos.org/download/)

CentOS是免费的、开源的、可以重新分发的开源操作系统

我的腾讯云服务器安装的是`CentOS 7.6`

#### [CentOS 7 配置SFTP](https://www.cnblogs.com/yyy-blog/p/11130302.html)

一、sftp 安装

二、sftp 简单操作

测试

```
sftp silent@127.0.0.1
silent@127.0.0.1's password: 
```

[centos7如何重启ssh服务](http://bjst.net.cn/ask/show-393511.html)

重启ssh服务 ——`慎用`

```
service sshd restart     
```

查看ssh服务状态

```
systemctl status sshd.service
```

开启ssh服务

```
systemctl start sshd.service
```

设置ssh服务开机自启

```
systemctl enable sshd.service
```

[命令行启动ssh_【树莓派】系统启用SSH服务](https://blog.csdn.net/weixin_35733852/article/details/112624508)

[ubuntu安装ssh并开机启动](https://doc.wendoc.com/bf17d393bee91e5e9e26bcf34593ac5ebb69e2e46.html)



#### 协议端口

[云服务器需要开放哪些端口](https://www.niuqi360.com/webmaster/the-common-vps-server-logical-port/)

协议端口支持以下格式：

- 单个端口: TCP:80
- 多个端口: UDP:80,443
- 连续端口: TCP:3306-20000
- 所有端口：ALL
- 协议端口(组)ID: ppm-1234ilbd
- 其它协议：ICMP，ICMPv6或GRE



#### [网站备案](https://console.cloud.tencent.com/beian/manage)

1. 身份证复印件摁手印
2. 广东省个人网站备案承诺书，主体负责人本人需手写日期＋签名(接受签名章，不接受连笔签)+按手印。
3. 网站名称
4. 联系方式

##### 备案材料

- 域名证书
- 域名实名认证截图
- 暂住证/居住证
- 网站建设方案书

#### 云服务器配置https协议

##### 一、SSL证书申请

1. 在`阿里云`中搜`SSL`，进去`SSL证书（应用安全）`  （域名在阿里云买的）

2. SSL证书——免费证书——创建证书

   ![创建证书](https://raw.githubusercontent.com/winney07/Images/main/winney07.github.io/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/%E9%98%BF%E9%87%8C%E4%BA%91%E8%B4%AD%E4%B9%B0%E5%85%8D%E8%B4%B9SSL%E8%AF%81%E4%B9%A6.png)

3. 证书申请：点击”证书申请“，填写证书绑定域名，域名验证方式（选择自动DNS验证），CSR生成方式（选择系统生成）等信息

   ![证书申请](https://raw.githubusercontent.com/winney07/Images/main/winney07.github.io/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/SSL%E5%AE%A1%E6%A0%B81.png)
   ![证书申请](https://raw.githubusercontent.com/winney07/Images/main/winney07.github.io/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/SSL%E7%94%B3%E8%AF%B7%E5%AE%A1%E6%A0%B8.png)


4. 验证信息（申请完之后，会返回相关的配置信息），域名授权验证类型，记录类型，主机记录，记录值等信息。需要在`阿里云——域名解析——解析设置`中添加一条记录，将以上信息填写进去

   `返回的配置信息：`

   ![返回的配置信息](https://raw.githubusercontent.com/winney07/Images/main/winney07.github.io/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/SSL%E5%AE%A1%E6%A0%B83.png)

   `添加记录：`

   - 如果在解析设置中，自动加好这条记录，就不需要手动添加

   - 如果在解析设置中，没有这条记录，要手动添加

   ![添加记录](https://raw.githubusercontent.com/winney07/Images/main/winney07.github.io/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90-%E6%B7%BB%E5%8A%A0%E8%AE%B0%E5%BD%95.png)

5. 刷新SSL证书页面，证书的状态就变成了`已签发`

   ![已签发](https://raw.githubusercontent.com/winney07/Images/main/winney07.github.io/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/SSL%E5%AE%A1%E6%A0%B84--%E5%B7%B2%E7%AD%BE%E5%8F%91.png)

##### 二、服务器证书安装前的准备

1. 证书签发成功，会收到阿里云发送的邮件
   1. 在`阿里云——SSL证书——免费证书`的列表中的操作列中`下载`证书，我下载的是`pem格式`，因为我的`腾讯云`服务器是Nginx的（服务器在腾讯云买的）
   
      ![下载证书](https://raw.githubusercontent.com/winney07/Images/main/winney07.github.io/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/%E4%B8%8B%E8%BD%BDSSL%E8%AF%81%E4%B9%A6.png)
   
   2. 确定您的证书是需要安装至Web服务器还是部署到阿里云云产品上
      1. 下载并安装至Web服务器，请点击 https://help.aliyun.com/document_detail/198938.html （我这里选择这个）
      2. 一键部署到阿里云云产品，请点击 https://help.aliyun.com/document_detail/98575.html
2. 选择 [在Nginx或Tengine服务器上安装证书](https://help.aliyun.com/document_detail/98728.html?spm=a2c4g.11186623.0.0.2bd24c010kqjxk) 文档——因我的服务器是使用`腾讯云的Nginx虚拟机`

   - 在`腾讯云`中搜索    [如何安装 SSL 证书](https://cloud.tencent.com/document/product/1207/54869)  ——> 选择 [Nginx 服务器证书安装](https://cloud.tencent.com/document/product/1207/47027)

   > 如果您使用的是其他品牌的虚拟主机，请参考对应的虚拟主机安装证书的操作指

##### 三、服务器SSL证书安装

1. 查找`nginx`所在的目录（我云服务器中的nginx目录跟文档中的目录不一样）

   ```
   whereis nginx
   ```

2. 找到`nginx.conf`所在目录（我云服务器的`nginx.conf`在`/etc/nginx`）

3. 编辑 Nginx 默认配置文件目录中的 `nginx.conf` 文件

   ```
   cd /etc/nginx
   ```

   ```
   vi nginx.conf
   ```

4. 上传证书文件名称和私钥文件名称到`/etc/nginx`目录

   ```
   rz -y
   ```

5. 将以下代码的`注释去掉`（原本以下代码是被注释掉的）

   ```
   server {
       listen       443 ssl http2;
       ........
       ........
   }
   ```

6. 修改`server{...}`里面的证书文件名称和私钥文件名称

   `注意：语句的后面要加;（分号）`

   ```
   // 原来的配置
   // ssl_certificate "/etc/pki/nginx/server.crf";
   // ssl_certificate_key "/etc/pki/nginx/private/server.key";
   
   // 修改后
   ssl_certificate "/etc/nginx/******.pem";
   ssl_certificate_key "/etc/nginx/******.key";
   ```

7. 找到 `http{...}`，并输入以下配置信息

   `注意：语句的后面要加;（分号）`

   ```
   ssl_certificate ******.pem;   # 填写您的证书文件名称
   ssl_certificate_key ******.key;    # 填写您的私钥文件名称
   ```

8. 保存修改后的 `nginx.conf` 文件后退出

   > 按esc退出编辑模式

   ```
   :wq
   ```

9. 执行以下命令，验证配置文件是否存在问题

   > 登录的是`root`账户，可以不使用`sudo`

   ```
sudo nginx -t
   ```
   
   若输出信息如下所示，则为配置成功，请继续执行
   
   ```
   nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
   nginx: configuration file /etc/nginx/nginx.conf test is successful
   ```
   
10. 执行以下命令，重启 `Nginx`

    ```
    sudo systemctl reload nginx
    ```

    至此已安装成功。您可使用 `https://cloud.tencent.com`（示例）正常进行访问。

    ![配置成功显示的页面](https://raw.githubusercontent.com/winney07/Images/main/winney07.github.io/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/SSL%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F.png)

11. 修改`https://******.com`访问的默认页面

    ```
    server {
        listen       443 ssl http2;
        listen       [::]:443 ssl http2;
        server_name  _;
       # root         /usr/share/nginx/html;   # 原来填写的路径
        root         /usr/webcode/wx;   # 在wx目录中新建index.html内容
    }
    ```

    

##### 设置 HTTP 请求自动跳转 HTTPS（可选）

```
server_name  www.winney07.cn;
return 301 https://$host$request_uri;
```

输入`nginx.conf`之后，报以下警告

```
nginx: [warn] conflicting server name "www.winney07.cn" on 0.0.0.0:80, ignored
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
[root@VM-8-7-centos nginx]# systemctl reload nginx
```

改为

```
server_name  winney07.cn;
return 301 https://$host$request_uri;
```

#### [linux如何开启ssh服务](https://www.kufanyun.com/idcnews/1384.html)

[Linux SSH 服务配置与管理](https://zhuanlan.zhihu.com/p/525614499)

#### CentOS 7 配置SFTP

[CentOS 7 配置SFTP](http://hk.javashuo.com/article/p-yessuomw-cb.html)

[CentOS 7 配置SFTP](http://www.javashuo.com/article/p-yessuomw-cb.html)

[centos7 sftp分配用户](https://blog.csdn.net/qq_32534855/article/details/115468504)

[CentOS 7 配置SFTP](https://www.lmlphp.com/user/57795/article/item/600744/)





### 命令

[Linux 命令（83）—— groups 命令](https://blog.csdn.net/K346K346/article/details/102842260)

```
groups root   // 显示root组成员
```

```
groups winney

// winney : sftp      // 控制台输出的内容
```

#### ssh

```
which ssh
```

```
which sshd
```

[ssh -V和openssl version 看到版本不一致问题解决](https://blog.csdn.net/lijq3370/article/details/117087061)

```
ssh -V
```

```
openssl version
```

[学习Linux命令:关于ssh命令](https://blog.csdn.net/weixin_45707610/article/details/127050436)

> SSH客户端及其相应的版本号。使用ssh -V命令可以得到版本号

#### [setenforce 0,setenforce命令](https://www.zhangshilong.cn/work/288868.html)

setenforce是Linux的selinux防火墙配置命令， 执行setenforce 0 表示关闭selinux防火墙。

#### 修改密码

```
password winney      // 修改winney用户的密码   （输入密码的时候，是不显示的密码的）
```

#### 查看当前所在目录

```
pwd

/root/test           #输出结果
```

> 执行 pwd 指令可立刻得知您目前所在的工作目录的绝对路径名称。

#### groups

显示当前用户所属的组

```
groups
```

[Linux 命令（83）—— groups 命令](https://blog.csdn.net/K346K346/article/details/102842260)

#### ll

```
ll
```

> “ls -l” "ls -al" ll 用来查询当前目录下文件及目录的详情

[Linux “ll“ 命令详解](https://blog.csdn.net/weixin_40170142/article/details/123913437)

#### [SSH密钥方式远程登录Linux云主机](https://jcloud.sjtu.edu.cn/document/detail.html?mod=cvm&id=1291)

执行如下命令，登录弹性云服务器。

```
ssh -i /path/kp-123.pem root@云主机公网IP
```

假设Linux云主机公网IP为：`123.123.123.123`，则命令如下：

```
ssh -i /path/kp-123.pem root@123.123.123.123
```

> 在git命令窗口，切换到密钥文件所在的路径，执行命令

说明：

- path为密钥文件的存放路径。
- 弹性公网IP地址为云主机绑定的公网IP地址。







待整理命令：

```
vi /etc/sysconfig/iptables
sudo vi /etc/sysconfig/iptables
ssh -V
groupadd sftp
sudo useradd -g sftp -s /sbin/nologin silent
sudo useradd -g sftp -s /sbin/nologin silent     // 再执行一次，可以看到useradd: user 'silent' already exists
cd /data/
ll
```

接：

```
sudo mkdir -p /data/sftp/silent
sudo usermod -d /data/sftp/silent silent
sudo vi /etc/ssh/sshd_config
sudo chown root:sftp /data/sftp/silent
sudo chmod 755 /data/sftp/silent
sudo mkdir /data/sftp/silent/upload
sudo chown silent:sftp /data/sftp/silent/upload
sudo vi /etc/selinux/config
sudo setenforce 0


sudo chmod 755 /data/sftp/silent/upload
```



```

```

